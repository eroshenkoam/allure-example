name: Java CI

on: [ push ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Download allurectl
        run: | 
          wget https://github.com/allure-framework/allurectl/releases/latest/download/allurectl_linux_386 -O ./allurectl
          printenv | grep "ALLURE\|GITHUB" > env.list
        env:
          ALLURE_ENDPOINT: https://demo.testops.cloud
          ALLURE_TOKEN: ${{ secrets.ALLURE_TOKEN }}
          ALLURE_PROJECT: 536
      - name: Docker Build
        run: docker build . -t autotests
      - name: Docker Run
        run: | 
          docker run --env-file env.list autotests \
                     allurectl watch --results build/allure-results ./gradlew clean test
