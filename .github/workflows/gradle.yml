name: Java CI

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      ALLURE_ENDPOINT: ${{ secrets.ALLURE_ENDPOINT }}
      ALLURE_TOKEN: ${{ secrets.ALLURE_TOKEN }}
      ALLURE_PROJECT_ID: ${{ secrets.ALLURE_PROJECT_ID }}
    steps:
    - uses: actions/checkout@v1
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - run: ./.allure/allurectl job-run start
    - run: ./gradlew test
    - run: ./.allure/allurectl upload --job-run-child build/allure-results
    - run: ./.allure/allurectl job-run stop
